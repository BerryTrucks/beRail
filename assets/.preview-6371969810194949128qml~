import bb.cascades 1.0
import bb.system 1.0
import be.rail 1.0

NavigationPane {
    id: navigationPane
    property Button element

    Page {
        titleBar: TitleBar {
            title: qsTr("beRail")
            acceptAction: ActionItem {
                id: searchAction
                title: qsTr("Zoeken")
                onTriggered: {
                    searchAction.enabled = false;
                    contentScroller.visible = false;
                    activityIndicator.visible = true;
                    activityIndicator.start();

                    routeVM.search()
                }
            }
        }

        Container {
            layout: DockLayout {
            }
            verticalAlignment: VerticalAlignment.Fill
            horizontalAlignment: HorizontalAlignment.Fill

            ActivityIndicator {
                id: activityIndicator
                verticalAlignment: VerticalAlignment.Center
                horizontalAlignment: HorizontalAlignment.Center
                preferredWidth: 200
                preferredHeight: 200
                visible: false
            }

            ScrollView {
                id: contentScroller
                Container {
                    layout: StackLayout {
                    }
                    horizontalAlignment: HorizontalAlignment.Fill
                    topPadding: 30
                    leftPadding: 20
                    rightPadding: 20

                    Button {
                        id: cmdFrom
                        text: qsTr("Van")
                        horizontalAlignment: HorizontalAlignment.Fill
                        onClicked: {
                            element = cmdFrom;

                            stationSheet.open();
                        }
                    }

                    Button {
                        id: cmdTo
                        text: qsTr("Tot")
                        horizontalAlignment: HorizontalAlignment.Fill
                        onClicked: {
                            element = cmdTo;

                            stationSheet.open();
                        }
                    }

                    Container {
                        layout: StackLayout {
                            orientation: LayoutOrientation.LeftToRight
                        }

                        DateTimePicker {
                            id: datePicker
                        }

                        DateTimePicker {
                            id: timePicker
                            mode: DateTimePickerMode.Time
                            minuteInterval: 10
                        }
                    }

                    SegmentedControl {
                        id: type
                        options: [
                            Option {
                                text: qsTr("Vertrekken")
                            },
                            Option {
                                text: qsTr("Aankomen")
                            }
                        ]
                    }
                }
            }
        }

        onCreationCompleted: {
            stationSheet.stationPicked.connect(stationPickedCompleted)
        }

        function stationPickedCompleted(text) {
            element.text = text;
        }

        attachedObjects: [
            StationPicker {
                id: stationSheet
            },
            RouteViewModel {
                id: routeVM
                from: cmdFrom.text != qsTr("Van") ? cmdFrom.text : ""
                to: cmdTo.text != qsTr("Tot") ? cmdTo.text : ""
                date: datePicker.value
                time: timePicker.value
                type: type.selectedIndex
                service: favoriteService
                onSelectionChanged: {
                    console.log("Something is selected");
                }
                onSearchCompleted: {
                    if (error != "") {
                        contentScroller.visible = true;
                        activityIndicator.visible = false;
                        activityIndicator.stop();

                        toast.body = qsTr(error);
                        toast.show();
                    } else {
                        var resultPage = searchResultPage.createObject();
                        
                        navigationPane.push(resultPage);

                        contentScroller.visible = true;
                        activityIndicator.visible = false;
                        activityIndicator.stop();
                    }

                    searchAction.enabled = true;
                }
            },
            SystemToast {
                id: toast
            }
        ]
    }
    
    attachedObjects: [
        ComponentDefinition {
            id: searchResultPage
            source: "asset:///SearchResultPage.qml"
        },
        ComponentDefinition {
            
        }
    ]
}
